// Pulse Generator
// based on Miller Puckette Pulse Train Generator
// from "The Theory and Technique of Electronic Music

private class DCRemover extends Chubgraph
{
    inlet => Gain subtract => outlet;
    inlet => OnePole onepole  => subtract; 

    0.9995 => float p;
    subtract.op(2);
    onepole.pole(p);
    // for p > 0:
    //     onepole.pole(p)
    // is equivalent to:
    //     onepole.b0(1-p); onepole.a1(-p);
}

public class PulseGen
{
    // DSP
    Phasor phasor => Gain pOffset => Clip clip => SinOsc osc => DCRemover highpass => Gain master => dac;
    Step pStep => pOffset;


    pStep.next(-0.25);
    osc.sync(1);
    clip.range(-0.25, 0.75);

    phasor.freq(100);

    5 => float maxMod;
    1 => float mod;
    phasor.gain(1 + mod);

    master.gain(0.35);

}